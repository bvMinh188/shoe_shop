
<div class="container">
    <div class="col-md-12">
        <h4>L·ªãch s·ª≠ mua h√†ng</h4>

        {{#if orders.length}}
            {{#each orders}}
                <div class="order-item border rounded p-3 mb-4">
                    <h5>üõí M√£ ƒë∆°n h√†ng: <strong>{{this._id}}</strong></h5>
                    <div><strong>Th·ªùi gian ƒë·∫∑t h√†ng:</strong> {{formatDate this.createdAt}}</div>
                    
                    {{#each products}}
                        <div class="d-flex border-bottom pb-3 pt-3">
                            <img src="{{this.image}}" alt="product" class="img-thumbnail" width="80">
                            <div class="ms-3">
                                <div><strong>{{this.name}}</strong></div>
                                <div>Size: {{this.size}}</div>
                                <div>x{{this.quantity}}</div>
                            </div>
                        </div>
                    {{/each}}

                    <div class="mt-3">
                        <strong>ƒê·ªãa ch·ªâ:</strong> {{this.address}}
                    </div>
                    <div>
                        <strong>Th√†nh ti·ªÅn:</strong> <span class="text-danger">{{formatPrince this.price}}</span>
                    </div>
                    <div>
                        <strong>Tr·∫°ng th√°i:</strong> <span class=" {{this.status}}">{{this.status}}</span>
                    </div>

                    {{#if (eq this.status "ch·ªù x√°c nh·∫≠n")}}
                        <div class="mt-3">
                            <button class="btn btn-danger cancel-order" data-id="{{this._id}}">H·ªßy ƒë∆°n</button>
                        </div>
                    {{/if}}
                </div>
            {{/each}}
        {{else}}
            <div class="alert alert-warning">B·∫°n ch∆∞a c√≥ ƒë∆°n h√†ng n√†o.</div>
        {{/if}}
    </div>
</div>




{{!-- Modal X√°c Nh·∫≠n X√≥a --}}
<div id="delete-order-modal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">H·ªßy ƒë∆°n h√†ng </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy ƒë∆°n h√†ng n√†y kh√¥ng?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
        <button id="btn-delete-order" type="button" class="btn btn-danger">c√≥</button>
      </div>
    </div>
  </div>
</div>

{{!-- Form ·∫®n --}}
<form name="delete-order-form" method="POST" style="display: none;">
    <input type="hidden" name="_method" value="DELETE">
</form>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        var orderId;
        var deleteForm = document.forms['delete-order-form'];
        var btnDeleteOrder = document.getElementById('btn-delete-order'); // ƒê√∫ng t√™n bi·∫øn

        // Khi modal ƒë∆∞·ª£c k√≠ch ho·∫°t
        $('#delete-order-modal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);  // L·∫•y button ƒë√£ k√≠ch ho·∫°t modal
            orderId = button.data('id');  // L·∫•y ID c·ªßa ƒë∆°n h√†ng
        });

        // Khi nh·∫•n n√∫t "X√≥a" trong modal
        btnDeleteOrder.onclick = function() { // S·ª≠a t√™n bi·∫øn th√†nh btnDeleteOrder
            deleteForm.action = '/admin/transaction/' + orderId + '?_method=DELETE';  // ƒê·∫∑t URL action c·ªßa form
            deleteForm.submit();  // G·ª≠i form
        };
    });
</script>

